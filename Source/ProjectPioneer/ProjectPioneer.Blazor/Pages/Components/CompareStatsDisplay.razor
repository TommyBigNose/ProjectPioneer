@using ProjectPioneer.Systems.Statistics;
@using System.Text.RegularExpressions;

@inject ILogger<CompareStatsDisplay> Logger
<h3>Compare Stats Display</h3>

<table class="table">
    <thead>
        <tr>
            <th>Stats</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                @foreach (var stat in GetComparedStats())
                {
                    if (Multipliers.Any() && Multipliers.Contains(@GetExtractedStatType(stat).Replace(" ", "")))
                    {
                        <b>@GetExtractedStatType(stat)</b>
                    }
                    else
                    {
                        @GetExtractedStatType(stat)
                    }
                    <text>&nbsp;</text><span style="@GetStatColor(stat)">@GetStatNumber(stat)</span>
                    <br />
                }
            </td>
        </tr>
    </tbody>
</table>

@code {
    [Parameter]
    public Stats Stats1 { get; set; }

    [Parameter]
    public Stats Stats2 { get; set; }

    [Parameter]
    public List<string> Multipliers { get; set; } = new List<string>();

    private List<string> GetComparedStats()
    {
        try
        {
            return Stats1.GetStatComparison(Stats2).GetStatsAsList();
        }
        catch
        {
            Logger.LogInformation("Failed to compare stats");
        }
        return new Stats().GetStatsAsList();
    }

    private string GetExtractedStatType(string stat)
    {
        // The following Regex gets the text up until the ':'
        // ^.*?(?=:)
        return Regex.Match(stat, @"^.*?(?=:)").Value;
    }

    private string GetStatNumber(string stat)
    {
        // The following Regex gets the numbers out of the string, including potentially negative numbers
        // -?\d+$
        return Regex.Match(stat, @"-?\d+$").Value;
    }

    private string GetStatColor(string stat)
    {
        int.TryParse(GetStatNumber(stat), out int statValue);
        
        string statStyle = $"color:@@color";

        if (statValue > 0)
        {
            statStyle = statStyle.Replace("@@color", "green");
        }
        else if (statValue < 0)
        {
            statStyle = statStyle.Replace("@@color", "red");
        }
        else
        {
            statStyle = statStyle.Replace("@@color", "blue");
        }

        return statStyle;
    }

    

}
